{% extends 'layouts/base.html' %}
{% block title %} Momentum Weeklies Configuration {% endblock title %}

{% block stylesheets %}
<style>
  .param-card { border-left: 4px solid #2dce89; transition: all 0.3s ease; }
  .param-card:hover { box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
  .tooltip-icon { cursor: help; color: #8898aa; font-size: 14px; margin-left: 5px; }
  .tooltip-icon:hover { color: #2dce89; }
  .profile-badge { cursor: pointer; transition: all 0.2s ease; }
  .profile-badge:hover { transform: scale(1.05); }
  .profile-badge.active { border: 2px solid #2dce89; }
  .param-slider { -webkit-appearance: none; width: 100%; height: 6px; border-radius: 3px; background: #e9ecef; outline: none; }
  .param-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%; background: linear-gradient(310deg, #2dce89 0%, #17a2b8 100%); cursor: pointer; }
  .implication-box { background: linear-gradient(to right, rgba(45,206,137,0.05), rgba(23,162,184,0.05)); border-radius: 8px; padding: 12px; margin-top: 8px; }
  .warning-implication { background: linear-gradient(to right, rgba(251,99,64,0.1), rgba(245,54,92,0.05)); }
</style>
{% endblock stylesheets %}

{% block content %}
<div class="container-fluid py-4">
  <div class="row mb-4">
    <div class="col-12">
      <div class="card bg-gradient-success">
        <div class="card-body p-4">
          <div class="row align-items-center">
            <div class="col-auto">
              <div class="icon icon-shape bg-white shadow text-center border-radius-md p-3">
                <i class="fas fa-bolt text-success fa-2x"></i>
              </div>
            </div>
            <div class="col">
              <h4 class="text-white mb-1">Momentum Weeklies Configuration</h4>
              <p class="text-white opacity-8 mb-0">Intraday reversals and news momentum for weekly options plays with quick exits.</p>
            </div>
            <div class="col-auto">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="strategyEnabled" checked style="width: 50px; height: 26px;">
                <label class="form-check-label text-white ms-2" for="strategyEnabled">Strategy Enabled</label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Profile Selection -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header pb-0">
          <h6><i class="fas fa-user-cog me-2"></i>Strategy Profile</h6>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-4 mb-3">
              <div class="card profile-badge active" data-profile="quick_scalp">
                <div class="card-body p-3 text-center">
                  <i class="fas fa-bolt fa-2x text-warning mb-2"></i>
                  <h6 class="mb-1">Quick Scalp</h6>
                  <p class="text-xs text-secondary mb-0">Fast entries, tight stops</p>
                </div>
              </div>
            </div>
            <div class="col-md-4 mb-3">
              <div class="card profile-badge" data-profile="momentum_rider">
                <div class="card-body p-3 text-center">
                  <i class="fas fa-chart-line fa-2x text-success mb-2"></i>
                  <h6 class="mb-1">Momentum Rider</h6>
                  <p class="text-xs text-secondary mb-0">Ride the trend longer</p>
                </div>
              </div>
            </div>
            <div class="col-md-4 mb-3">
              <div class="card profile-badge" data-profile="reversal_hunter">
                <div class="card-body p-3 text-center">
                  <i class="fas fa-sync-alt fa-2x text-info mb-2"></i>
                  <h6 class="mb-1">Reversal Hunter</h6>
                  <p class="text-xs text-secondary mb-0">V-shape reversal focus</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- Signal Detection -->
    <div class="col-lg-6 mb-4">
      <div class="card param-card h-100">
        <div class="card-header pb-0">
          <h6><i class="fas fa-broadcast-tower me-2"></i>Signal Detection</h6>
        </div>
        <div class="card-body">
          <div class="mb-4">
            <label class="form-label d-flex justify-content-between">
              <span>Volume Spike Threshold <i class="fas fa-info-circle tooltip-icon" data-bs-toggle="tooltip" title="Minimum volume multiple vs average to trigger signal. 3x means current volume is 3x normal"></i></span>
              <span class="badge bg-gradient-success" id="volSpikeValue">3.0x</span>
            </label>
            <input type="range" class="param-slider" id="volSpike" min="20" max="80" value="30">
            <div class="implication-box">
              <small class="text-secondary"><i class="fas fa-chart-bar text-success me-1"></i><strong>3.0x volume:</strong> Standard threshold - catches most significant moves without too many false signals.</small>
            </div>
          </div>

          <div class="mb-4">
            <label class="form-label d-flex justify-content-between">
              <span>Bounce Threshold (%) <i class="fas fa-info-circle tooltip-icon" data-bs-toggle="tooltip" title="Minimum % bounce from intraday low to trigger bullish reversal signal"></i></span>
              <span class="badge bg-gradient-info" id="bounceValue">1.5%</span>
            </label>
            <input type="range" class="param-slider" id="bounce" min="10" max="40" value="15">
            <div class="implication-box" id="bounceImplication">
              <small class="text-secondary"><i class="fas fa-sync-alt text-info me-1"></i><strong>1.5% bounce:</strong> Catches early V-shape reversals. Lower = more signals but more false positives. Higher = stronger confirmation but may miss the move.</small>
            </div>
          </div>

          <div class="mb-4">
            <label class="form-label d-flex justify-content-between">
              <span>Momentum Threshold (%) <i class="fas fa-info-circle tooltip-icon" data-bs-toggle="tooltip" title="Price momentum % change to trigger momentum signal"></i></span>
              <span class="badge bg-gradient-primary" id="momentumValue">2.0%</span>
            </label>
            <input type="range" class="param-slider" id="momentum" min="10" max="50" value="20">
            <div class="implication-box" id="momentumImplication">
              <small class="text-secondary"><i class="fas fa-rocket text-primary me-1"></i><strong>2.0% momentum:</strong> Good for catching news-driven moves. Filters out minor fluctuations. For volatile stocks, consider 3%+.</small>
            </div>
          </div>

          <div class="mb-4">
            <label class="form-label">Signal Types to Monitor</label>
            <div class="row">
              <div class="col-6">
                <div class="form-check"><input class="form-check-input" type="checkbox" id="signalReversal" checked><label class="form-check-label" for="signalReversal">Bullish Reversals</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="signalMomentum" checked><label class="form-check-label" for="signalMomentum">News Momentum</label></div>
              </div>
              <div class="col-6">
                <div class="form-check"><input class="form-check-input" type="checkbox" id="signalBreakout" checked><label class="form-check-label" for="signalBreakout">Breakouts</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="signalVolSpike"><label class="form-check-label" for="signalVolSpike">Volume Spikes Only</label></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Trade Execution -->
    <div class="col-lg-6 mb-4">
      <div class="card param-card h-100">
        <div class="card-header pb-0">
          <h6><i class="fas fa-exchange-alt me-2"></i>Trade Execution</h6>
        </div>
        <div class="card-body">
          <div class="mb-4">
            <label class="form-label d-flex justify-content-between">
              <span>Max Hold Time (Hours) <i class="fas fa-info-circle tooltip-icon" data-bs-toggle="tooltip" title="WSB rule: same-day exits preferred. Maximum time to hold before forced exit"></i></span>
              <span class="badge bg-gradient-warning" id="maxHoldValue">4 hours</span>
            </label>
            <input type="range" class="param-slider" id="maxHold" min="1" max="8" value="4">
            <div class="implication-box" id="maxHoldImplication">
              <small class="text-secondary"><i class="fas fa-clock text-warning me-1"></i><strong>4 hours max:</strong> Forces same-day exit discipline. WSB pros recommend exiting before the 3pm theta crush. Shorter = more discipline, longer = risk overnight gaps.</small>
            </div>
          </div>

          <div class="mb-4">
            <label class="form-label d-flex justify-content-between">
              <span>Position Size (% Portfolio) <i class="fas fa-info-circle tooltip-icon" data-bs-toggle="tooltip" title="Size per trade as percentage of portfolio"></i></span>
              <span class="badge bg-gradient-primary" id="positionSizeValue">2.5%</span>
            </label>
            <input type="range" class="param-slider" id="positionSize" min="10" max="50" value="25">
            <div class="implication-box" id="positionSizeImplication">
              <small class="text-secondary"><i class="fas fa-balance-scale text-primary me-1"></i><strong>2.5% per trade:</strong> With $10,000 portfolio = $250 max per position. Conservative for weeklies. Allows ~40 trades to diversify risk.</small>
            </div>
          </div>

          <div class="mb-4">
            <label class="form-label">Profit Targets (Scale Out)</label>
            <div class="row">
              <div class="col-4">
                <label class="form-label text-xs">25% Exit</label>
                <input type="number" class="form-control form-control-sm" value="25" id="profitTarget1">
              </div>
              <div class="col-4">
                <label class="form-label text-xs">50% Exit</label>
                <input type="number" class="form-control form-control-sm" value="50" id="profitTarget2">
              </div>
              <div class="col-4">
                <label class="form-label text-xs">100% Exit</label>
                <input type="number" class="form-control form-control-sm" value="100" id="profitTarget3">
              </div>
            </div>
          </div>

          <div class="mb-4">
            <label class="form-label d-flex justify-content-between">
              <span>Stop Loss (%) <i class="fas fa-info-circle tooltip-icon" data-bs-toggle="tooltip" title="Exit if option value drops by this percentage"></i></span>
              <span class="badge bg-gradient-danger" id="stopLossValue">30%</span>
            </label>
            <input type="range" class="param-slider" id="stopLoss" min="10" max="50" value="30">
            <div class="implication-box warning-implication" id="stopLossImplication">
              <small class="text-secondary"><i class="fas fa-shield-alt text-danger me-1"></i><strong>30% stop:</strong> Weekly options are volatile - tighter stops get triggered by normal swings. 30% gives room to work while limiting downside. Consider 40-50% for 0DTE plays.</small>
            </div>
          </div>

          <div class="alert alert-info mb-0 mt-3">
            <i class="fas fa-lightbulb me-2"></i><strong>Pro Tip:</strong> Scale out at profit targets (sell 25% at first target, etc.) to lock in gains while letting winners run. Never let a winner turn into a loser!
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Watchlist & Expiry -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card param-card">
        <div class="card-header pb-0">
          <h6><i class="fas fa-list me-2"></i>Watchlist & Expiry Settings</h6>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Mega Cap Tickers (High Liquidity)</label>
              <div class="row">
                <div class="col-6">
                  <div class="form-check"><input class="form-check-input" type="checkbox" checked> AAPL</div>
                  <div class="form-check"><input class="form-check-input" type="checkbox" checked> MSFT</div>
                  <div class="form-check"><input class="form-check-input" type="checkbox" checked> GOOGL</div>
                  <div class="form-check"><input class="form-check-input" type="checkbox" checked> AMZN</div>
                </div>
                <div class="col-6">
                  <div class="form-check"><input class="form-check-input" type="checkbox" checked> TSLA</div>
                  <div class="form-check"><input class="form-check-input" type="checkbox" checked> NVDA</div>
                  <div class="form-check"><input class="form-check-input" type="checkbox" checked> META</div>
                  <div class="form-check"><input class="form-check-input" type="checkbox" checked> NFLX</div>
                </div>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Weekly Expiry Preference</label>
              <select class="form-select mb-3" id="expiryPref">
                <option value="current" selected>Current Week Friday</option>
                <option value="next">Next Week Friday</option>
                <option value="smart">Smart (Mon-Tue: current, Wed-Thu: next)</option>
              </select>
              <label class="form-label">Scan Interval</label>
              <select class="form-select" id="scanInterval">
                <option value="60">Every minute</option>
                <option value="300" selected>Every 5 minutes</option>
                <option value="900">Every 15 minutes</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <button class="btn btn-outline-secondary mb-0"><i class="fas fa-undo me-2"></i>Reset</button>
              <button class="btn btn-outline-info mb-0 ms-2"><i class="fas fa-download me-2"></i>Export</button>
            </div>
            <div>
              <button class="btn btn-outline-warning mb-0 me-2"><i class="fas fa-history me-2"></i>Backtest</button>
              <button class="btn bg-gradient-success mb-0"><i class="fas fa-save me-2"></i>Save Configuration</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  {% include "includes/footer.html" %}
</div>
{% endblock content %}

{% block javascripts %}
<script>
  var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
  tooltipTriggerList.map(el => new bootstrap.Tooltip(el));

  document.getElementById('volSpike').addEventListener('input', function() {
    document.getElementById('volSpikeValue').textContent = (this.value / 10).toFixed(1) + 'x';
  });
  document.getElementById('bounce').addEventListener('input', function() {
    document.getElementById('bounceValue').textContent = (this.value / 10).toFixed(1) + '%';
  });
  document.getElementById('momentum').addEventListener('input', function() {
    document.getElementById('momentumValue').textContent = (this.value / 10).toFixed(1) + '%';
  });
  document.getElementById('maxHold').addEventListener('input', function() {
    document.getElementById('maxHoldValue').textContent = this.value + ' hours';
  });
  document.getElementById('positionSize').addEventListener('input', function() {
    document.getElementById('positionSizeValue').textContent = (this.value / 10).toFixed(1) + '%';
  });
  document.getElementById('stopLoss').addEventListener('input', function() {
    document.getElementById('stopLossValue').textContent = this.value + '%';
  });

  document.querySelectorAll('.profile-badge').forEach(badge => {
    badge.addEventListener('click', function() {
      document.querySelectorAll('.profile-badge').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
    });
  });
</script>
{% endblock javascripts %}
