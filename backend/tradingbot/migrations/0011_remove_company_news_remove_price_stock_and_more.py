# Generated by Django 5.2.6 on 2025-12-31 14:51

import datetime
import django.db.models.deletion
import django.utils.timezone
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('tradingbot', '0010_auto_20220519_1822'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.RemoveField(
            model_name='company',
            name='news',
        ),
        migrations.RemoveField(
            model_name='price',
            name='stock',
        ),
        migrations.RemoveField(
            model_name='stockinstance',
            name='portfolio',
        ),
        migrations.RemoveField(
            model_name='stockinstance',
            name='stock',
        ),
        migrations.RemoveField(
            model_name='stockinstance',
            name='user',
        ),
        migrations.RemoveField(
            model_name='stocktrade',
            name='company',
        ),
        migrations.RemoveField(
            model_name='company',
            name='tweets',
        ),
        migrations.AlterModelOptions(
            name='order',
            options={'ordering': ['date']},
        ),
        migrations.AlterModelOptions(
            name='portfolio',
            options={'ordering': ['name']},
        ),
        migrations.AlterModelOptions(
            name='stock',
            options={'ordering': ['date']},
        ),
        migrations.RemoveField(
            model_name='order',
            name='client_order_id',
        ),
        migrations.RemoveField(
            model_name='order',
            name='filled_avg_price',
        ),
        migrations.RemoveField(
            model_name='order',
            name='filled_quantity',
        ),
        migrations.RemoveField(
            model_name='order',
            name='filled_timestamp',
        ),
        migrations.RemoveField(
            model_name='order',
            name='limit_price',
        ),
        migrations.RemoveField(
            model_name='order',
            name='order_number',
        ),
        migrations.RemoveField(
            model_name='order',
            name='order_type',
        ),
        migrations.RemoveField(
            model_name='order',
            name='stop_price',
        ),
        migrations.RemoveField(
            model_name='order',
            name='timestamp',
        ),
        migrations.RemoveField(
            model_name='order',
            name='transaction_type',
        ),
        migrations.RemoveField(
            model_name='order',
            name='user',
        ),
        migrations.RemoveField(
            model_name='portfolio',
            name='cash',
        ),
        migrations.AddField(
            model_name='order',
            name='date',
            field=models.DateField(default=datetime.date.today),
        ),
        migrations.AddField(
            model_name='order',
            name='id',
            field=models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID'),
        ),
        migrations.AddField(
            model_name='order',
            name='price',
            field=models.DecimalField(decimal_places=2, default=0, help_text='Order price', max_digits=10),
        ),
        migrations.AddField(
            model_name='order',
            name='side',
            field=models.CharField(choices=[('buy', 'Buy'), ('sell', 'Sell')], default='buy', help_text='Order side', max_length=10),
        ),
        migrations.AddField(
            model_name='stock',
            name='date',
            field=models.DateField(default=datetime.date.today),
        ),
        migrations.AddField(
            model_name='stock',
            name='price',
            field=models.DecimalField(decimal_places=2, default=0, max_digits=10),
        ),
        migrations.AlterField(
            model_name='order',
            name='quantity',
            field=models.IntegerField(default=0, help_text='Order quantity'),
        ),
        migrations.AlterField(
            model_name='order',
            name='status',
            field=models.CharField(choices=[('pending', 'Pending'), ('filled', 'Filled'), ('cancelled', 'Cancelled')], default='pending', help_text='Order status', max_length=20),
        ),
        migrations.AlterField(
            model_name='order',
            name='stock',
            field=models.ForeignKey(blank=True, help_text='Associated stock', null=True, on_delete=django.db.models.deletion.CASCADE, to='tradingbot.stock'),
        ),
        migrations.AlterField(
            model_name='portfolio',
            name='strategy',
            field=models.CharField(choices=[('manual', 'Manual portfolio management'), ('hmm_naive_even_split', 'HMM model prediction + Even split portfolio'), ('ma_sharp_ratio_monte_carlo', 'Moving average+Sharpe ratio Monte Carlo simulation'), ('hmm_sharp_ratio_monte_carlo', 'HMM model prediction + Sharpe ratio Monte Carlo simulation')], default='manual', help_text='Strategy', max_length=100),
        ),
        migrations.AlterField(
            model_name='stock',
            name='company',
            field=models.ForeignKey(help_text='Associated company', on_delete=django.db.models.deletion.CASCADE, to='tradingbot.company'),
        ),
        migrations.CreateModel(
            name='Bot',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(help_text='Bot name', max_length=100)),
                ('portfolio', models.ForeignKey(help_text='Associated portfolio', on_delete=django.db.models.deletion.CASCADE, to='tradingbot.portfolio')),
                ('user', models.ForeignKey(help_text='Associated user', on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['name'],
            },
        ),
        migrations.AddField(
            model_name='order',
            name='bot',
            field=models.ForeignKey(blank=True, help_text='Associated bot', null=True, on_delete=django.db.models.deletion.CASCADE, to='tradingbot.bot'),
        ),
        migrations.CreateModel(
            name='CircuitBreakerEvent',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('breaker_type', models.CharField(choices=[('daily_loss', 'Daily Loss Limit'), ('vix_critical', 'VIX Critical'), ('vix_extreme', 'VIX Extreme'), ('error_rate', 'Error Rate Spike'), ('stale_data', 'Stale Data'), ('consecutive_loss', 'Consecutive Losses'), ('position_limit', 'Position Count Limit'), ('margin_call', 'Margin Call Risk'), ('manual', 'Manual Trigger')], db_index=True, help_text='Type of circuit breaker that triggered', max_length=50)),
                ('triggered_at', models.DateTimeField(db_index=True, default=django.utils.timezone.now, help_text='When the circuit breaker was triggered')),
                ('trigger_value', models.DecimalField(decimal_places=4, help_text='The value that caused the trigger (e.g., loss amount, VIX level)', max_digits=14)),
                ('trigger_threshold', models.DecimalField(decimal_places=4, help_text='The threshold that was exceeded', max_digits=14)),
                ('trigger_context', models.JSONField(blank=True, default=dict, help_text='Additional context (positions, market conditions, etc.)')),
                ('resolved_at', models.DateTimeField(blank=True, help_text='When the circuit breaker was resolved (full trading resumed)', null=True)),
                ('resolution_method', models.CharField(choices=[('auto_time', 'Auto Time-Based'), ('auto_condition', 'Auto Condition-Based'), ('auto_hybrid', 'Auto Hybrid (Time + Condition)'), ('manual', 'Manual Reset'), ('override', 'Admin Override'), ('pending', 'Pending Resolution')], default='pending', help_text='How the breaker was resolved', max_length=20)),
                ('current_recovery_mode', models.CharField(choices=[('paused', 'Paused'), ('restricted', 'Restricted'), ('cautious', 'Cautious'), ('normal', 'Normal')], default='paused', help_text='Current recovery mode for this event', max_length=20)),
                ('recovery_mode_until', models.DateTimeField(blank=True, help_text='When full trading should resume (for time-based recovery)', null=True)),
                ('recovery_schedule', models.JSONField(blank=True, default=list, help_text='Recovery schedule with stages and conditions')),
                ('recovery_stage', models.IntegerField(default=0, help_text='Current stage in recovery schedule (0-indexed)')),
                ('last_stage_advance', models.DateTimeField(blank=True, help_text='When the recovery stage last advanced', null=True)),
                ('recovery_trades_count', models.IntegerField(default=0, help_text='Number of trades executed during recovery')),
                ('recovery_profitable_trades', models.IntegerField(default=0, help_text='Number of profitable trades during recovery')),
                ('recovery_pnl', models.DecimalField(decimal_places=2, default=0, help_text='P&L during recovery period', max_digits=14)),
                ('notes', models.TextField(blank=True, help_text='Admin notes or justification for actions')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.ForeignKey(help_text='User affected by this circuit breaker event', on_delete=django.db.models.deletion.CASCADE, related_name='circuit_breaker_events', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-triggered_at'],
            },
        ),
        migrations.CreateModel(
            name='CircuitBreakerState',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('breaker_type', models.CharField(db_index=True, help_text='Type of circuit breaker (daily_loss, vix, error_rate, stale_data, global)', max_length=50)),
                ('status', models.CharField(choices=[('ok', 'OK'), ('warning', 'Warning'), ('triggered', 'Triggered'), ('critical', 'Critical')], db_index=True, default='ok', help_text='Current breaker status', max_length=20)),
                ('current_value', models.DecimalField(blank=True, decimal_places=4, help_text='Current measured value (drawdown %, VIX level, error count)', max_digits=14, null=True)),
                ('threshold', models.DecimalField(blank=True, decimal_places=4, help_text='Threshold that triggers the breaker', max_digits=14, null=True)),
                ('tripped_at', models.DateTimeField(blank=True, db_index=True, help_text='When the breaker was tripped', null=True)),
                ('trip_reason', models.CharField(blank=True, help_text='Reason the breaker tripped', max_length=255)),
                ('cooldown_until', models.DateTimeField(blank=True, help_text='When cooldown ends and reset is possible', null=True)),
                ('vix_level', models.CharField(choices=[('none', 'None'), ('elevated', 'Elevated'), ('extreme', 'Extreme'), ('critical', 'Critical')], default='none', help_text='Current VIX trip level', max_length=20)),
                ('current_vix', models.DecimalField(blank=True, decimal_places=2, help_text='Current VIX value', max_digits=8, null=True)),
                ('last_vix_check', models.DateTimeField(blank=True, help_text='When VIX was last checked', null=True)),
                ('errors_last_minute', models.IntegerField(default=0, help_text='Error count in current minute window')),
                ('error_window_start', models.DateTimeField(blank=True, help_text='Start of current error window', null=True)),
                ('start_of_day_equity', models.DecimalField(blank=True, decimal_places=2, help_text='Equity at start of trading day', max_digits=14, null=True)),
                ('current_equity', models.DecimalField(blank=True, decimal_places=2, help_text='Current equity value', max_digits=14, null=True)),
                ('daily_drawdown', models.DecimalField(blank=True, decimal_places=4, help_text='Current daily drawdown as decimal (0.05 = 5%)', max_digits=8, null=True)),
                ('last_data_timestamp', models.DateTimeField(blank=True, help_text='Timestamp of last fresh data', null=True)),
                ('last_daily_reset', models.DateField(blank=True, help_text='Date of last daily reset', null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.ForeignKey(blank=True, help_text='User for this breaker state (null for global)', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='circuit_breaker_states', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['breaker_type', 'user'],
            },
        ),
        migrations.CreateModel(
            name='CircuitBreakerHistory',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('action', models.CharField(choices=[('trip', 'Tripped'), ('reset', 'Reset'), ('warning', 'Warning'), ('daily_reset', 'Daily Reset'), ('vix_change', 'VIX Level Change'), ('equity_update', 'Equity Update'), ('error_spike', 'Error Spike'), ('cooldown_end', 'Cooldown Ended')], db_index=True, help_text='Type of state change', max_length=30)),
                ('timestamp', models.DateTimeField(db_index=True, default=django.utils.timezone.now, help_text='When this action occurred')),
                ('previous_status', models.CharField(blank=True, help_text='Status before the action', max_length=20)),
                ('new_status', models.CharField(blank=True, help_text='Status after the action', max_length=20)),
                ('value_at_action', models.DecimalField(blank=True, decimal_places=4, help_text='Relevant value when action occurred', max_digits=14, null=True)),
                ('threshold_at_action', models.DecimalField(blank=True, decimal_places=4, help_text='Threshold at time of action', max_digits=14, null=True)),
                ('reason', models.CharField(blank=True, help_text='Reason or description for the action', max_length=255)),
                ('metadata', models.JSONField(blank=True, default=dict, help_text='Additional context data')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('state', models.ForeignKey(help_text='Circuit breaker state this entry relates to', on_delete=django.db.models.deletion.CASCADE, related_name='history', to='tradingbot.circuitbreakerstate')),
            ],
            options={
                'verbose_name_plural': 'Circuit breaker histories',
                'ordering': ['-timestamp'],
            },
        ),
        migrations.CreateModel(
            name='CustomStrategy',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(db_index=True, max_length=100)),
                ('description', models.TextField(blank=True)),
                ('definition', models.JSONField(default=dict)),
                ('universe', models.CharField(choices=[('sp500', 'S&P 500'), ('nasdaq100', 'Nasdaq 100'), ('dow30', 'Dow 30'), ('russell2000', 'Russell 2000'), ('custom', 'Custom List'), ('all', 'All US Stocks')], default='sp500', max_length=20)),
                ('custom_symbols', models.JSONField(blank=True, default=list, help_text='Custom list of symbols when universe is "custom"')),
                ('is_active', models.BooleanField(default=False, help_text='Whether strategy is actively trading')),
                ('is_validated', models.BooleanField(default=False, help_text='Whether strategy has passed validation')),
                ('validation_errors', models.JSONField(blank=True, help_text='List of validation errors if any', null=True)),
                ('validation_warnings', models.JSONField(blank=True, help_text='List of validation warnings', null=True)),
                ('is_template', models.BooleanField(default=False, help_text='Whether this is a template strategy')),
                ('is_public', models.BooleanField(default=False, help_text='Whether this strategy is publicly visible')),
                ('clone_count', models.PositiveIntegerField(default=0)),
                ('backtest_results', models.JSONField(blank=True, help_text='Most recent backtest results', null=True)),
                ('live_performance', models.JSONField(blank=True, help_text='Live trading performance metrics', null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('last_backtest_at', models.DateTimeField(blank=True, null=True)),
                ('activated_at', models.DateTimeField(blank=True, null=True)),
                ('deactivated_at', models.DateTimeField(blank=True, null=True)),
                ('cloned_from', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='clones', to='tradingbot.customstrategy')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='custom_strategies', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Custom Strategy',
                'verbose_name_plural': 'Custom Strategies',
                'ordering': ['-updated_at'],
            },
        ),
        migrations.CreateModel(
            name='DataQualityMetrics',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('timestamp', models.DateTimeField(default=django.utils.timezone.now, help_text='Metrics timestamp')),
                ('validation_state', models.CharField(help_text='Validation state at time of measurement', max_length=20)),
                ('overall_score', models.FloatField(help_text='Overall data quality score (0-1)')),
                ('source_scores', models.JSONField(help_text='Quality scores by data source')),
                ('recommendations', models.JSONField(default=list, help_text='Data quality recommendations')),
                ('data_age_seconds', models.FloatField(help_text='Age of most recent data in seconds')),
                ('stale_data_count', models.IntegerField(help_text='Number of stale data points')),
            ],
            options={
                'ordering': ['-timestamp'],
                'indexes': [models.Index(fields=['validation_state', 'timestamp'], name='tradingbot__validat_356f38_idx'), models.Index(fields=['overall_score', 'timestamp'], name='tradingbot__overall_2bf741_idx')],
            },
        ),
        migrations.CreateModel(
            name='DigestLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('digest_type', models.CharField(choices=[('daily', 'Daily Digest'), ('weekly', 'Weekly Digest')], help_text='Type of digest (daily or weekly)', max_length=20)),
                ('period_start', models.DateTimeField(help_text='Start of the period covered by this digest')),
                ('period_end', models.DateTimeField(help_text='End of the period covered by this digest')),
                ('scheduled_at', models.DateTimeField(auto_now_add=True, help_text='When the digest was scheduled/created')),
                ('sent_at', models.DateTimeField(blank=True, help_text='When the digest was actually sent', null=True)),
                ('delivery_status', models.CharField(choices=[('pending', 'Pending'), ('sent', 'Sent'), ('failed', 'Failed'), ('bounced', 'Bounced')], default='pending', help_text='Current delivery status', max_length=20)),
                ('error_message', models.TextField(blank=True, default='', help_text='Error message if delivery failed')),
                ('opened_at', models.DateTimeField(blank=True, help_text='When the user opened the email (via tracking pixel)', null=True)),
                ('clicked_at', models.DateTimeField(blank=True, help_text='When the user clicked a link in the email', null=True)),
                ('data_snapshot', models.JSONField(default=dict, help_text='Snapshot of data included in the digest:\n        {\n            "summary": {\n                "total_trades": 15,\n                "winning_trades": 10,\n                "losing_trades": 5,\n                "total_pnl": 1250.50,\n                "win_rate": 66.67\n            },\n            "trades": [\n                {"symbol": "AAPL", "action": "BUY", "quantity": 10, "pnl": 150.00}\n            ],\n            "alerts": [\n                {"type": "risk", "message": "Portfolio drawdown exceeded 5%"}\n            ],\n            "positions": {\n                "open_count": 5,\n                "total_value": 25000.00\n            },\n            "performance": {\n                "period_return": 2.5,\n                "benchmark_return": 1.8,\n                "alpha": 0.7\n            }\n        }')),
                ('email_subject', models.CharField(blank=True, default='', help_text='Subject line of the sent email', max_length=255)),
                ('email_recipient', models.EmailField(blank=True, default='', help_text='Email address the digest was sent to', max_length=254)),
                ('user', models.ForeignKey(help_text='The user this digest was sent to', on_delete=django.db.models.deletion.CASCADE, related_name='digest_logs', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-scheduled_at'],
            },
        ),
        migrations.CreateModel(
            name='SignalValidationHistory',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('strategy_name', models.CharField(db_index=True, help_text='Name of the strategy that generated the signal', max_length=100)),
                ('symbol', models.CharField(db_index=True, help_text='Trading symbol (e.g., AAPL, SPY)', max_length=20)),
                ('signal_type', models.CharField(help_text='Type of signal (e.g., BUY_CALL, SELL_PUT, BREAKOUT)', max_length=50)),
                ('strength_score', models.FloatField(help_text='Signal strength score (0-100)')),
                ('quality_grade', models.CharField(help_text='Quality grade (A, B, C, D, F)', max_length=2)),
                ('recommended_action', models.CharField(help_text='Recommended action (execute, reduce_size, wait, reject)', max_length=20)),
                ('suggested_position_size', models.FloatField(default=1.0, help_text='Suggested position size multiplier (0.0-1.0)')),
                ('confidence_level', models.FloatField(default=0.5, help_text='Confidence level in the validation (0.0-1.0)')),
                ('validation_details', models.JSONField(default=dict, help_text='Detailed validation metrics and criteria results')),
                ('was_executed', models.BooleanField(default=False, help_text='Whether the signal was actually executed')),
                ('execution_timestamp', models.DateTimeField(blank=True, help_text='When the signal was executed (if applicable)', null=True)),
                ('actual_position_size', models.FloatField(blank=True, help_text='Actual position size used', null=True)),
                ('trade_outcome', models.CharField(blank=True, help_text='Trade outcome (profit, loss, break_even, pending)', max_length=20, null=True)),
                ('trade_pnl', models.FloatField(blank=True, help_text='Trade P&L if closed', null=True)),
                ('trade_pnl_percent', models.FloatField(blank=True, help_text='Trade P&L percentage', null=True)),
                ('outcome_recorded_at', models.DateTimeField(blank=True, help_text='When the trade outcome was recorded', null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True, help_text='When the signal was validated')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='Last update timestamp')),
            ],
            options={
                'verbose_name': 'Signal Validation History',
                'verbose_name_plural': 'Signal Validation Histories',
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['strategy_name', 'created_at'], name='tradingbot__strateg_3acbde_idx'), models.Index(fields=['symbol', 'created_at'], name='tradingbot__symbol_014201_idx'), models.Index(fields=['quality_grade', 'created_at'], name='tradingbot__quality_3b6005_idx'), models.Index(fields=['recommended_action', 'created_at'], name='tradingbot__recomme_36aed2_idx'), models.Index(fields=['was_executed', 'created_at'], name='tradingbot__was_exe_ada887_idx'), models.Index(fields=['trade_outcome', 'created_at'], name='tradingbot__trade_o_3a5805_idx')],
            },
        ),
        migrations.CreateModel(
            name='SignalValidationMetrics',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('strategy_name', models.CharField(help_text='Strategy name', max_length=100)),
                ('timestamp', models.DateTimeField(default=django.utils.timezone.now, help_text='Metrics timestamp')),
                ('total_signals', models.IntegerField(help_text='Total signals processed')),
                ('validated_signals', models.IntegerField(help_text='Signals that passed validation')),
                ('rejected_signals', models.IntegerField(help_text='Signals that failed validation')),
                ('average_validation_score', models.FloatField(help_text='Average validation score')),
                ('validation_latency_ms', models.FloatField(help_text='Average validation latency in milliseconds')),
                ('false_positive_rate', models.FloatField(help_text='False positive rate')),
                ('false_negative_rate', models.FloatField(help_text='False negative rate')),
                ('precision', models.FloatField(help_text='Precision metric')),
                ('recall', models.FloatField(help_text='Recall metric')),
                ('f1_score', models.FloatField(help_text='F1 score')),
                ('overall_health', models.CharField(help_text='Overall validation health', max_length=20)),
                ('issues', models.JSONField(default=list, help_text='Identified issues')),
                ('recommendations', models.JSONField(default=list, help_text='Recommendations')),
            ],
            options={
                'ordering': ['-timestamp'],
                'indexes': [models.Index(fields=['strategy_name', 'timestamp'], name='tradingbot__strateg_fd3623_idx'), models.Index(fields=['overall_health', 'timestamp'], name='tradingbot__overall_344521_idx')],
            },
        ),
        migrations.CreateModel(
            name='StrategyAllocationLimit',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('strategy_name', models.CharField(db_index=True, help_text='Strategy identifier (e.g., wsb-dip-bot)', max_length=100)),
                ('allocated_pct', models.DecimalField(decimal_places=2, help_text='Allocated percentage of portfolio (e.g., 20.00 for 20%)', max_digits=5)),
                ('allocated_amount', models.DecimalField(decimal_places=2, default=0, help_text='Allocated dollar amount (calculated from portfolio value)', max_digits=14)),
                ('current_exposure', models.DecimalField(decimal_places=2, default=0, help_text='Current dollar exposure (sum of open positions)', max_digits=14)),
                ('reserved_amount', models.DecimalField(decimal_places=2, default=0, help_text='Amount reserved for pending orders', max_digits=14)),
                ('is_enabled', models.BooleanField(default=True, help_text='Whether allocation limits are enforced for this strategy')),
                ('last_updated', models.DateTimeField(auto_now=True, help_text='Last update timestamp')),
                ('last_reconciled', models.DateTimeField(blank=True, help_text='Last reconciliation timestamp', null=True)),
                ('user', models.ForeignKey(help_text='User who owns this allocation', on_delete=django.db.models.deletion.CASCADE, related_name='strategy_allocations', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-allocated_pct'],
            },
        ),
        migrations.CreateModel(
            name='AllocationReservation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('order_id', models.CharField(db_index=True, help_text='Alpaca order ID or internal order reference', max_length=100, unique=True)),
                ('symbol', models.CharField(help_text='Trading symbol', max_length=20)),
                ('amount', models.DecimalField(decimal_places=2, help_text='Reserved amount', max_digits=14)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('filled', 'Filled'), ('cancelled', 'Cancelled'), ('expired', 'Expired')], default='pending', help_text='Reservation status', max_length=20)),
                ('created_at', models.DateTimeField(auto_now_add=True, help_text='Reservation creation time')),
                ('resolved_at', models.DateTimeField(blank=True, help_text='When the reservation was resolved', null=True)),
                ('allocation', models.ForeignKey(help_text='Associated strategy allocation', on_delete=django.db.models.deletion.CASCADE, related_name='reservations', to='tradingbot.strategyallocationlimit')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='StrategyPerformanceSnapshot',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('strategy_name', models.CharField(db_index=True, help_text='Name of the strategy', max_length=100)),
                ('snapshot_date', models.DateField(db_index=True, help_text='Date of the snapshot')),
                ('period', models.CharField(choices=[('daily', 'Daily'), ('weekly', 'Weekly'), ('monthly', 'Monthly')], default='daily', help_text='Snapshot period type', max_length=10)),
                ('total_return_pct', models.DecimalField(decimal_places=4, default=0, help_text='Total return percentage for the period', max_digits=10)),
                ('sharpe_ratio', models.DecimalField(decimal_places=4, default=0, help_text='Sharpe ratio (risk-adjusted return)', max_digits=8)),
                ('sortino_ratio', models.DecimalField(blank=True, decimal_places=4, help_text='Sortino ratio (downside risk-adjusted return)', max_digits=8, null=True)),
                ('max_drawdown_pct', models.DecimalField(decimal_places=4, default=0, help_text='Maximum drawdown percentage', max_digits=10)),
                ('win_rate', models.DecimalField(decimal_places=2, default=0, help_text='Win rate percentage', max_digits=6)),
                ('profit_factor', models.DecimalField(decimal_places=4, default=0, help_text='Gross profit / gross loss ratio', max_digits=10)),
                ('trades_count', models.IntegerField(default=0, help_text='Number of trades in the period')),
                ('winning_trades', models.IntegerField(default=0, help_text='Number of winning trades')),
                ('losing_trades', models.IntegerField(default=0, help_text='Number of losing trades')),
                ('avg_hold_duration_hours', models.DecimalField(blank=True, decimal_places=2, help_text='Average holding duration in hours', max_digits=10, null=True)),
                ('volatility', models.DecimalField(blank=True, decimal_places=4, help_text='Annualized volatility', max_digits=10, null=True)),
                ('var_95', models.DecimalField(blank=True, decimal_places=4, help_text='Value at Risk (95% confidence)', max_digits=10, null=True)),
                ('calmar_ratio', models.DecimalField(blank=True, decimal_places=4, help_text='Calmar ratio (return / max drawdown)', max_digits=8, null=True)),
                ('benchmark_return_pct', models.DecimalField(decimal_places=4, default=0, help_text='Benchmark (SPY) return for same period', max_digits=10)),
                ('vs_spy_return', models.DecimalField(decimal_places=4, default=0, help_text='Excess return vs SPY', max_digits=10)),
                ('beta', models.DecimalField(blank=True, decimal_places=4, help_text='Beta coefficient vs market', max_digits=8, null=True)),
                ('alpha', models.DecimalField(blank=True, decimal_places=4, help_text="Jensen's alpha", max_digits=10, null=True)),
                ('correlation_spy', models.DecimalField(blank=True, decimal_places=4, help_text='Correlation with SPY', max_digits=6, null=True)),
                ('total_pnl', models.DecimalField(decimal_places=2, default=0, help_text='Total profit/loss amount', max_digits=18)),
                ('avg_win', models.DecimalField(decimal_places=2, default=0, help_text='Average winning trade amount', max_digits=18)),
                ('avg_loss', models.DecimalField(decimal_places=2, default=0, help_text='Average losing trade amount', max_digits=18)),
                ('rank_by_sharpe', models.IntegerField(blank=True, help_text='Rank by Sharpe ratio for this date/period', null=True)),
                ('rank_by_return', models.IntegerField(blank=True, help_text='Rank by total return for this date/period', null=True)),
                ('rank_by_risk_adjusted', models.IntegerField(blank=True, help_text='Rank by risk-adjusted score (composite)', null=True)),
                ('equity_curve', models.JSONField(blank=True, default=list, help_text='Daily equity values for the period')),
                ('monthly_returns', models.JSONField(blank=True, default=dict, help_text='Monthly return breakdown')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'ordering': ['-snapshot_date', 'strategy_name'],
                'indexes': [models.Index(fields=['snapshot_date', 'period'], name='tradingbot__snapsho_66cdb7_idx'), models.Index(fields=['strategy_name', 'period'], name='tradingbot__strateg_87d581_idx'), models.Index(fields=['sharpe_ratio'], name='tradingbot__sharpe__12f707_idx'), models.Index(fields=['total_return_pct'], name='tradingbot__total_r_6557c2_idx')],
                'unique_together': {('strategy_name', 'snapshot_date', 'period')},
            },
        ),
        migrations.CreateModel(
            name='StrategyPortfolio',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(help_text='User-friendly portfolio name', max_length=100)),
                ('description', models.TextField(blank=True, help_text='Description of portfolio strategy and goals')),
                ('risk_profile', models.CharField(choices=[('conservative', 'Conservative'), ('moderate', 'Moderate'), ('aggressive', 'Aggressive'), ('custom', 'Custom')], default='moderate', help_text='Risk profile classification', max_length=20)),
                ('is_template', models.BooleanField(default=False, help_text='True if this is a system template available to all users')),
                ('is_active', models.BooleanField(default=False, help_text='True if this portfolio is currently active for trading')),
                ('strategies', models.JSONField(default=dict, help_text='Strategy allocations and configurations')),
                ('performance_metrics', models.JSONField(blank=True, default=dict, help_text='Combined performance metrics across strategies')),
                ('correlation_matrix', models.JSONField(blank=True, default=dict, help_text='Correlation matrix between strategies')),
                ('diversification_score', models.DecimalField(decimal_places=2, default=0, help_text='Diversification score (0-100)', max_digits=5)),
                ('expected_sharpe', models.DecimalField(blank=True, decimal_places=2, help_text='Expected Sharpe ratio based on historical analysis', max_digits=5, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('last_rebalanced_at', models.DateTimeField(blank=True, help_text='Last time portfolio allocations were rebalanced', null=True)),
                ('user', models.ForeignKey(blank=True, help_text='User who owns this portfolio (null for system templates)', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='strategy_portfolios', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Strategy Portfolio',
                'verbose_name_plural': 'Strategy Portfolios',
                'ordering': ['-is_active', '-updated_at'],
            },
        ),
        migrations.CreateModel(
            name='TaxLot',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('symbol', models.CharField(db_index=True, help_text='Trading symbol', max_length=20)),
                ('order_id', models.CharField(blank=True, help_text='Original order ID that created this lot', max_length=100, null=True)),
                ('original_quantity', models.DecimalField(decimal_places=6, help_text='Original quantity purchased', max_digits=18)),
                ('remaining_quantity', models.DecimalField(decimal_places=6, help_text='Remaining quantity after partial sales', max_digits=18)),
                ('cost_basis_per_share', models.DecimalField(decimal_places=6, help_text='Cost basis per share', max_digits=18)),
                ('total_cost_basis', models.DecimalField(decimal_places=6, help_text='Total cost basis for this lot', max_digits=18)),
                ('acquired_at', models.DateTimeField(help_text='Date and time lot was acquired')),
                ('acquisition_type', models.CharField(choices=[('purchase', 'Purchase'), ('dividend_reinvest', 'Dividend Reinvestment'), ('transfer_in', 'Transfer In'), ('gift', 'Gift'), ('inheritance', 'Inheritance'), ('exercise', 'Option Exercise'), ('rsu_vest', 'RSU Vest'), ('split', 'Stock Split')], default='purchase', help_text='How the shares were acquired', max_length=30)),
                ('is_long_term', models.BooleanField(default=False, help_text='Whether held for more than 1 year (computed)')),
                ('days_held', models.IntegerField(default=0, help_text='Number of days held (computed)')),
                ('wash_sale_adjustment', models.DecimalField(decimal_places=6, default=0, help_text='Disallowed loss added to cost basis due to wash sale', max_digits=18)),
                ('is_wash_sale_replacement', models.BooleanField(default=False, help_text='Whether this lot is a wash sale replacement purchase')),
                ('wash_sale_disallowed_loss', models.DecimalField(decimal_places=6, default=0, help_text='Total disallowed loss from wash sales on this lot', max_digits=18)),
                ('current_price', models.DecimalField(blank=True, decimal_places=6, help_text='Current market price', max_digits=18, null=True)),
                ('unrealized_gain', models.DecimalField(blank=True, decimal_places=6, help_text='Unrealized gain/loss (can be negative)', max_digits=18, null=True)),
                ('unrealized_gain_pct', models.DecimalField(blank=True, decimal_places=4, help_text='Unrealized gain/loss percentage', max_digits=10, null=True)),
                ('market_value', models.DecimalField(blank=True, decimal_places=6, help_text='Current market value of remaining shares', max_digits=18, null=True)),
                ('price_updated_at', models.DateTimeField(blank=True, help_text='When current_price was last updated', null=True)),
                ('is_closed', models.BooleanField(default=False, help_text='Whether all shares have been sold')),
                ('closed_at', models.DateTimeField(blank=True, help_text='When the lot was fully closed', null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.ForeignKey(help_text='Owner of this tax lot', on_delete=django.db.models.deletion.CASCADE, related_name='tax_lots', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['symbol', 'acquired_at'],
            },
        ),
        migrations.CreateModel(
            name='TaxLotSale',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('symbol', models.CharField(db_index=True, help_text='Trading symbol', max_length=20)),
                ('quantity_sold', models.DecimalField(decimal_places=6, help_text='Number of shares sold from this lot', max_digits=18)),
                ('sale_price', models.DecimalField(decimal_places=6, help_text='Price per share at sale', max_digits=18)),
                ('proceeds', models.DecimalField(decimal_places=6, help_text='Total sale proceeds', max_digits=18)),
                ('sold_at', models.DateTimeField(help_text='Date and time of sale')),
                ('order_id', models.CharField(blank=True, help_text='Sell order ID', max_length=100, null=True)),
                ('cost_basis_sold', models.DecimalField(decimal_places=6, help_text='Cost basis of shares sold', max_digits=18)),
                ('realized_gain', models.DecimalField(decimal_places=6, help_text='Realized gain/loss (proceeds - cost basis)', max_digits=18)),
                ('is_gain', models.BooleanField(help_text='True if gain, False if loss')),
                ('is_long_term', models.BooleanField(help_text='Whether this was a long-term holding')),
                ('is_wash_sale', models.BooleanField(default=False, help_text='Whether this sale triggered a wash sale')),
                ('wash_sale_disallowed', models.DecimalField(decimal_places=6, default=0, help_text='Amount of loss disallowed due to wash sale', max_digits=18)),
                ('wash_sale_replacement_lot_id', models.IntegerField(blank=True, help_text='ID of the replacement lot if wash sale', null=True)),
                ('lot_selection_method', models.CharField(default='fifo', help_text='Method used to select this lot', max_length=20)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('tax_lot', models.ForeignKey(help_text='The tax lot being sold from', on_delete=django.db.models.deletion.CASCADE, related_name='sales', to='tradingbot.taxlot')),
                ('user', models.ForeignKey(help_text='User who made the sale', on_delete=django.db.models.deletion.CASCADE, related_name='tax_lot_sales', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-sold_at'],
            },
        ),
        migrations.CreateModel(
            name='TradeSignalSnapshot',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('trade_id', models.CharField(db_index=True, help_text='Unique trade identifier (alpaca order ID or internal ID)', max_length=100, unique=True)),
                ('strategy_name', models.CharField(db_index=True, help_text='Strategy that generated the trade', max_length=100)),
                ('symbol', models.CharField(db_index=True, help_text='Trading symbol', max_length=20)),
                ('direction', models.CharField(choices=[('buy', 'Buy'), ('sell', 'Sell'), ('buy_to_cover', 'Buy to Cover'), ('sell_short', 'Sell Short')], help_text='Trade direction', max_length=20)),
                ('entry_price', models.DecimalField(decimal_places=4, help_text='Price at entry', max_digits=12)),
                ('quantity', models.DecimalField(decimal_places=4, help_text='Trade quantity', max_digits=12)),
                ('signals_at_entry', models.JSONField(default=dict, help_text='Snapshot of all signals at trade time. Structure:\n        {\n            "rsi": {"value": 28, "threshold": 30, "triggered": true, "period": 14},\n            "macd": {"value": -0.5, "signal": -0.3, "histogram": -0.2, "crossover": true},\n            "volume": {"current": 5000000, "average": 2000000, "ratio": 2.5},\n            "price_action": {"change_pct": -3.2, "from_sma20": -5.1, "from_sma50": -8.2},\n            "bollinger": {"upper": 155.2, "lower": 148.3, "position": "below_lower"},\n            "stochastic": {"k": 15, "d": 18, "oversold": true},\n            "atr": {"value": 2.5, "percent": 1.8},\n            "trend": {"short_term": "bearish", "medium_term": "bearish", "long_term": "bullish"}\n        }')),
                ('confidence_score', models.IntegerField(default=50, help_text='Confidence score (0-100) based on signal alignment')),
                ('signals_triggered', models.IntegerField(default=0, help_text='Number of signals that triggered this trade')),
                ('signals_checked', models.IntegerField(default=0, help_text='Total signals checked')),
                ('explanation', models.TextField(blank=True, help_text='Auto-generated explanation of why this trade was triggered')),
                ('similar_historical_trades', models.JSONField(default=list, help_text='List of similar historical trade setups:\n        [\n            {"trade_id": "abc123", "similarity": 0.92, "outcome": "profit", "pnl_pct": 5.2},\n            {"trade_id": "def456", "similarity": 0.87, "outcome": "loss", "pnl_pct": -2.1}\n        ]')),
                ('entry_reasoning', models.JSONField(blank=True, help_text='Structured reasoning for trade entry:\n        {\n            "summary": "RSI oversold + MACD bullish crossover on high volume",\n            "signals": {\n                "rsi": {"value": 28, "threshold": 30, "met": true},\n                "macd": {"histogram": 0.5, "crossover": true, "met": true},\n                "volume": {"ratio": 2.3, "threshold": 1.5, "met": true}\n            },\n            "confidence": 85,\n            "market_context": {\n                "spy_trend": "up",\n                "vix": 18.5,\n                "sector_performance": 1.2\n            },\n            "timestamp": "2024-01-15T10:30:00Z"\n        }', null=True)),
                ('exit_reasoning', models.JSONField(blank=True, help_text='Structured reasoning for trade exit:\n        {\n            "summary": "Profit target reached",\n            "trigger": "take_profit",\n            "held_duration": "3 days",\n            "held_duration_hours": 72,\n            "signals_at_exit": {\n                "rsi": {"value": 72, "overbought": true},\n                "price_vs_entry": {"pct_gain": 5.2}\n            },\n            "timestamp": "2024-01-18T14:45:00Z"\n        }', null=True)),
                ('outcome_analysis', models.JSONField(blank=True, help_text='Post-trade analysis filled after exit:\n        {\n            "pnl": 150.00,\n            "pnl_pct": 3.2,\n            "vs_hold": 1.5,\n            "timing_score": "good",\n            "entry_timing_analysis": {\n                "optimal_entry_price": 148.50,\n                "actual_vs_optimal_pct": 0.5,\n                "entered_early_or_late": "slightly_early"\n            },\n            "exit_timing_analysis": {\n                "max_price_during_hold": 158.20,\n                "captured_pct_of_max": 82.5\n            },\n            "similar_trades_avg_pnl": 2.8,\n            "similar_trades_win_rate": 0.65,\n            "notes": "Exited slightly early, could have captured 0.5% more",\n            "analyzed_at": "2024-01-18T15:00:00Z"\n        }', null=True)),
                ('exit_price', models.DecimalField(blank=True, decimal_places=4, help_text='Price at exit', max_digits=12, null=True)),
                ('exit_timestamp', models.DateTimeField(blank=True, help_text='When the position was closed', null=True)),
                ('outcome', models.CharField(blank=True, choices=[('profit', 'Profit'), ('loss', 'Loss'), ('break_even', 'Break Even'), ('open', 'Still Open')], help_text='Trade outcome', max_length=20, null=True)),
                ('pnl_amount', models.DecimalField(blank=True, decimal_places=2, help_text='Profit/loss amount', max_digits=12, null=True)),
                ('pnl_percent', models.DecimalField(blank=True, decimal_places=2, help_text='Profit/loss percentage', max_digits=8, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True, help_text='When the snapshot was captured')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='Last update')),
                ('order', models.ForeignKey(blank=True, help_text='Associated Order if available', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='signal_snapshots', to='tradingbot.order')),
            ],
            options={
                'verbose_name': 'Trade Signal Snapshot',
                'verbose_name_plural': 'Trade Signal Snapshots',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='UserProfile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('risk_tolerance', models.IntegerField(blank=True, choices=[(1, 'Very Conservative'), (2, 'Conservative'), (3, 'Moderate'), (4, 'Aggressive'), (5, 'Very Aggressive')], help_text='User risk tolerance level (1-5)', null=True)),
                ('risk_score', models.IntegerField(blank=True, help_text='Calculated risk score from questionnaire (1-100)', null=True)),
                ('investment_timeline', models.CharField(blank=True, choices=[('short', 'Short-term (< 1 year)'), ('medium', 'Medium-term (1-5 years)'), ('long', 'Long-term (5-10 years)'), ('very_long', 'Very Long-term (10+ years)')], help_text='Investment time horizon', max_length=20, null=True)),
                ('max_loss_tolerance', models.DecimalField(blank=True, decimal_places=2, help_text='Maximum acceptable loss percentage (e.g., 10.00 for 10%)', max_digits=5, null=True)),
                ('risk_assessment_answers', models.JSONField(blank=True, default=dict, help_text='Stored answers from risk questionnaire')),
                ('investable_capital', models.DecimalField(blank=True, decimal_places=2, help_text='Total investable capital', max_digits=12, null=True)),
                ('income_source', models.CharField(blank=True, choices=[('employment', 'Employment'), ('self_employed', 'Self-Employed'), ('trading', 'Full-time Trading'), ('retirement', 'Retirement'), ('other', 'Other')], help_text='Primary income source', max_length=20, null=True)),
                ('annual_income', models.DecimalField(blank=True, decimal_places=2, help_text='Annual income for suitability', max_digits=12, null=True)),
                ('capital_is_risk_capital', models.BooleanField(help_text='Whether user can afford to lose this capital', null=True)),
                ('net_worth', models.DecimalField(blank=True, decimal_places=2, help_text='Total net worth for suitability', max_digits=14, null=True)),
                ('trading_experience', models.CharField(blank=True, choices=[('none', 'No Experience'), ('beginner', 'Beginner (< 1 year)'), ('intermediate', 'Intermediate (1-3 years)'), ('advanced', 'Advanced (3-5 years)'), ('expert', 'Expert (5+ years)')], help_text='Level of trading experience', max_length=20, null=True)),
                ('options_experience', models.BooleanField(default=False, help_text='Has options trading experience')),
                ('options_level', models.IntegerField(blank=True, help_text='Options trading level (1-4)', null=True)),
                ('crypto_experience', models.BooleanField(default=False, help_text='Has cryptocurrency trading experience')),
                ('margin_experience', models.BooleanField(default=False, help_text='Has margin trading experience')),
                ('shorting_experience', models.BooleanField(default=False, help_text='Has short selling experience')),
                ('onboarding_completed', models.BooleanField(default=False, help_text='Whether onboarding is complete')),
                ('onboarding_step', models.IntegerField(default=1, help_text='Current onboarding step (1-5)')),
                ('onboarding_started_at', models.DateTimeField(blank=True, help_text='When user started onboarding', null=True)),
                ('onboarding_completed_at', models.DateTimeField(blank=True, help_text='When user completed onboarding', null=True)),
                ('risk_assessment_completed', models.BooleanField(default=False, help_text='Risk assessment questionnaire completed')),
                ('brokerage_connected', models.BooleanField(default=False, help_text='Brokerage account connected')),
                ('first_strategy_activated', models.BooleanField(default=False, help_text='At least one strategy has been activated')),
                ('first_trade_executed', models.BooleanField(default=False, help_text='First trade has been executed')),
                ('is_paper_trading', models.BooleanField(default=True, help_text='Whether user is in paper trading mode')),
                ('paper_trading_start', models.DateTimeField(blank=True, help_text='When paper trading started', null=True)),
                ('live_trading_approved', models.BooleanField(default=False, help_text='Whether user has been approved for live trading')),
                ('live_trading_approved_at', models.DateTimeField(blank=True, help_text='When live trading was approved', null=True)),
                ('dashboard_layout', models.JSONField(blank=True, default=dict, help_text='Custom dashboard widget layout preferences')),
                ('default_chart_timeframe', models.CharField(choices=[('1D', '1 Day'), ('1W', '1 Week'), ('1M', '1 Month'), ('3M', '3 Months'), ('6M', '6 Months'), ('1Y', '1 Year'), ('YTD', 'Year to Date'), ('ALL', 'All Time')], default='1M', help_text='Default chart timeframe', max_length=10)),
                ('timezone', models.CharField(default='America/New_York', help_text='User timezone for display', max_length=50)),
                ('theme', models.CharField(default='light', help_text='UI theme preference', max_length=20)),
                ('compact_mode', models.BooleanField(default=False, help_text='Use compact UI mode')),
                ('show_tutorial_hints', models.BooleanField(default=True, help_text='Show tutorial hints in UI')),
                ('email_frequency', models.CharField(choices=[('realtime', 'Real-time'), ('hourly', 'Hourly'), ('daily', 'Daily Digest'), ('weekly', 'Weekly'), ('none', 'None')], default='realtime', help_text='Email notification frequency', max_length=20)),
                ('email_trade_alerts', models.BooleanField(default=True, help_text='Receive trade execution alerts')),
                ('email_risk_alerts', models.BooleanField(default=True, help_text='Receive risk/circuit breaker alerts')),
                ('email_performance_reports', models.BooleanField(default=True, help_text='Receive periodic performance reports')),
                ('push_notifications_enabled', models.BooleanField(default=False, help_text='Enable push notifications')),
                ('sms_alerts_enabled', models.BooleanField(default=False, help_text='Enable SMS alerts')),
                ('phone_number', models.CharField(blank=True, help_text='Phone number for SMS alerts', max_length=20, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True, help_text='When profile was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When profile was last updated')),
                ('last_active_at', models.DateTimeField(blank=True, help_text='Last user activity timestamp', null=True)),
                ('last_login_at', models.DateTimeField(blank=True, help_text='Last login timestamp', null=True)),
                ('user', models.OneToOneField(help_text='The Django user this profile belongs to', on_delete=django.db.models.deletion.CASCADE, related_name='profile', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'User Profile',
                'verbose_name_plural': 'User Profiles',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ValidationParameterRegistry',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('strategy_name', models.CharField(help_text='Strategy name', max_length=100)),
                ('frozen_params', models.JSONField(help_text='Frozen parameter set')),
                ('random_seed', models.IntegerField(help_text='Random seed used')),
                ('requirements_sha256', models.CharField(help_text='SHA256 of requirements.txt', max_length=64)),
                ('python_version', models.CharField(help_text='Python version', max_length=50)),
                ('git_commit', models.CharField(help_text='Git commit hash', max_length=40)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, help_text='Creation timestamp')),
                ('file_path', models.CharField(help_text='Path to frozen parameter file', max_length=500)),
            ],
            options={
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['strategy_name', 'created_at'], name='tradingbot__strateg_6296ca_idx'), models.Index(fields=['git_commit'], name='tradingbot__git_com_4ea076_idx')],
            },
        ),
        migrations.CreateModel(
            name='ValidationRun',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('run_id', models.CharField(help_text='Unique validation run identifier', max_length=100, unique=True)),
                ('strategy_name', models.CharField(help_text='Strategy being validated', max_length=100)),
                ('timestamp', models.DateTimeField(default=django.utils.timezone.now, help_text='Validation run timestamp')),
                ('validation_state', models.CharField(choices=[('HEALTHY', 'Healthy'), ('THROTTLE', 'Throttled'), ('HALT', 'Halted')], help_text='Validation state', max_length=20)),
                ('overall_recommendation', models.CharField(help_text='GO or NO-GO recommendation', max_length=10)),
                ('deployment_readiness_score', models.FloatField(help_text='Deployment readiness score (0-1)')),
                ('validation_results', models.JSONField(help_text='Detailed validation results')),
                ('gate_result', models.JSONField(help_text='Validation gate evaluation result')),
                ('failing_criteria', models.JSONField(default=list, help_text='List of failing criteria')),
            ],
            options={
                'ordering': ['-timestamp'],
                'indexes': [models.Index(fields=['strategy_name', 'timestamp'], name='tradingbot__strateg_54ccf0_idx'), models.Index(fields=['validation_state', 'timestamp'], name='tradingbot__validat_3abd45_idx')],
            },
        ),
        migrations.DeleteModel(
            name='News',
        ),
        migrations.DeleteModel(
            name='Price',
        ),
        migrations.DeleteModel(
            name='StockInstance',
        ),
        migrations.DeleteModel(
            name='StockTrade',
        ),
        migrations.DeleteModel(
            name='Tweets',
        ),
        migrations.AddIndex(
            model_name='circuitbreakerevent',
            index=models.Index(fields=['user', 'triggered_at'], name='tradingbot__user_id_d69ad7_idx'),
        ),
        migrations.AddIndex(
            model_name='circuitbreakerevent',
            index=models.Index(fields=['breaker_type', 'triggered_at'], name='tradingbot__breaker_07a578_idx'),
        ),
        migrations.AddIndex(
            model_name='circuitbreakerevent',
            index=models.Index(fields=['user', 'resolved_at'], name='tradingbot__user_id_dc6785_idx'),
        ),
        migrations.AddIndex(
            model_name='circuitbreakerevent',
            index=models.Index(fields=['current_recovery_mode'], name='tradingbot__current_a12bf1_idx'),
        ),
        migrations.AddIndex(
            model_name='circuitbreakerstate',
            index=models.Index(fields=['user', 'breaker_type'], name='tradingbot__user_id_b961ae_idx'),
        ),
        migrations.AddIndex(
            model_name='circuitbreakerstate',
            index=models.Index(fields=['status', 'tripped_at'], name='tradingbot__status_f91175_idx'),
        ),
        migrations.AddIndex(
            model_name='circuitbreakerstate',
            index=models.Index(fields=['breaker_type', 'status'], name='tradingbot__breaker_04d8fe_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='circuitbreakerstate',
            unique_together={('user', 'breaker_type')},
        ),
        migrations.AddIndex(
            model_name='circuitbreakerhistory',
            index=models.Index(fields=['state', 'timestamp'], name='tradingbot__state_i_0bacf8_idx'),
        ),
        migrations.AddIndex(
            model_name='circuitbreakerhistory',
            index=models.Index(fields=['action', 'timestamp'], name='tradingbot__action_5a593e_idx'),
        ),
        migrations.AddIndex(
            model_name='customstrategy',
            index=models.Index(fields=['user', 'is_active'], name='tradingbot__user_id_fc6230_idx'),
        ),
        migrations.AddIndex(
            model_name='customstrategy',
            index=models.Index(fields=['is_template', 'is_public'], name='tradingbot__is_temp_84c28b_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='customstrategy',
            unique_together={('user', 'name')},
        ),
        migrations.AddIndex(
            model_name='digestlog',
            index=models.Index(fields=['user', 'digest_type', 'period_start'], name='tradingbot__user_id_f7cc42_idx'),
        ),
        migrations.AddIndex(
            model_name='digestlog',
            index=models.Index(fields=['delivery_status', 'scheduled_at'], name='tradingbot__deliver_a40e11_idx'),
        ),
        migrations.AddIndex(
            model_name='digestlog',
            index=models.Index(fields=['digest_type', 'sent_at'], name='tradingbot__digest__c5d952_idx'),
        ),
        migrations.AddConstraint(
            model_name='digestlog',
            constraint=models.UniqueConstraint(fields=('user', 'digest_type', 'period_start'), name='unique_user_digest_period'),
        ),
        migrations.AddIndex(
            model_name='strategyallocationlimit',
            index=models.Index(fields=['user', 'strategy_name'], name='tradingbot__user_id_a323b0_idx'),
        ),
        migrations.AddIndex(
            model_name='strategyallocationlimit',
            index=models.Index(fields=['strategy_name', 'last_updated'], name='tradingbot__strateg_bec365_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='strategyallocationlimit',
            unique_together={('user', 'strategy_name')},
        ),
        migrations.AddIndex(
            model_name='allocationreservation',
            index=models.Index(fields=['allocation', 'status'], name='tradingbot__allocat_3bb13e_idx'),
        ),
        migrations.AddIndex(
            model_name='allocationreservation',
            index=models.Index(fields=['order_id'], name='tradingbot__order_i_c09c45_idx'),
        ),
        migrations.AddConstraint(
            model_name='strategyportfolio',
            constraint=models.UniqueConstraint(condition=models.Q(('is_active', True)), fields=('user',), name='unique_active_portfolio_per_user'),
        ),
        migrations.AddIndex(
            model_name='taxlot',
            index=models.Index(fields=['symbol', 'acquired_at'], name='tradingbot__symbol_f6a503_idx'),
        ),
        migrations.AddIndex(
            model_name='taxlot',
            index=models.Index(fields=['user', 'symbol'], name='tradingbot__user_id_cdbf93_idx'),
        ),
        migrations.AddIndex(
            model_name='taxlot',
            index=models.Index(fields=['user', 'is_closed'], name='tradingbot__user_id_b7b87d_idx'),
        ),
        migrations.AddIndex(
            model_name='taxlot',
            index=models.Index(fields=['acquired_at'], name='tradingbot__acquire_d8deff_idx'),
        ),
        migrations.AddIndex(
            model_name='taxlotsale',
            index=models.Index(fields=['symbol', 'sold_at'], name='tradingbot__symbol_dabfba_idx'),
        ),
        migrations.AddIndex(
            model_name='taxlotsale',
            index=models.Index(fields=['user', 'sold_at'], name='tradingbot__user_id_df2fdf_idx'),
        ),
        migrations.AddIndex(
            model_name='taxlotsale',
            index=models.Index(fields=['is_wash_sale'], name='tradingbot__is_wash_bc4334_idx'),
        ),
        migrations.AddIndex(
            model_name='tradesignalsnapshot',
            index=models.Index(fields=['strategy_name', 'created_at'], name='tradingbot__strateg_c01ee0_idx'),
        ),
        migrations.AddIndex(
            model_name='tradesignalsnapshot',
            index=models.Index(fields=['symbol', 'created_at'], name='tradingbot__symbol_40c6f0_idx'),
        ),
        migrations.AddIndex(
            model_name='tradesignalsnapshot',
            index=models.Index(fields=['confidence_score', 'created_at'], name='tradingbot__confide_a9d42c_idx'),
        ),
        migrations.AddIndex(
            model_name='tradesignalsnapshot',
            index=models.Index(fields=['outcome', 'created_at'], name='tradingbot__outcome_a1912d_idx'),
        ),
    ]
